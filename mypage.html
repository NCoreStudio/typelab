<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ãƒã‚¤ãƒšãƒ¼ã‚¸ï½œSHINDAN LAB</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Kaisei+Decol:wght@400;700&family=Zen+Kaku+Gothic+New:wght@300;400;700;900&family=DotGothic16&family=M+PLUS+Rounded+1c:wght@300;400;700&display=swap" rel="stylesheet">

<!-- Firebase v9 CDN (compatç‰ˆ) -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHINDAN LAB â€” å…±é€šãƒ‡ã‚¶ã‚¤ãƒ³ãƒˆãƒ¼ã‚¯ãƒ³
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --ink:         #1a1424;
  --ink-mid:     #5c4f6e;
  --ink-soft:    #9b8fb0;
  --bg:          #faf8ff;
  --bg-warm:     #f7f4f0;
  --paper:       #ffffff;
  --love:        #ff6b9d;
  --love-light:  #ffe4ef;
  --love-dark:   #d63880;
  --friend:      #43c59e;
  --friend-light:#d9f5ec;
  --friend-dark: #2a9a7a;
  --work:        #5b8dee;
  --work-light:  #dde9ff;
  --work-dark:   #3a6bcc;
  --other:       #f5a623;
  --other-light: #fef0d5;
  --other-dark:  #c87e10;
  --accent:      #7c3aed;
  --accent-light:#ede9fe;
  --shadow-sm:   0 2px 8px rgba(90,60,120,.10);
  --shadow-md:   0 4px 24px rgba(90,60,120,.14);
  --shadow-lg:   0 8px 40px rgba(90,60,120,.18);
  --font-display:'Kaisei Decol', serif;
  --font-body:   'Zen Kaku Gothic New', sans-serif;
  --font-dot:    'DotGothic16', sans-serif;
  --font-round:  'M PLUS Rounded 1c', sans-serif;
  --r-sm: 8px; --r-md: 16px; --r-lg: 24px; --r-xl: 36px; --r-full: 9999px;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html { scroll-behavior: smooth; font-size: 16px; }
body {
  font-family: var(--font-body);
  background: var(--bg);
  color: var(--ink);
  overflow-x: hidden;
  min-height: 100vh;
}
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 0;
  opacity: 0.5;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HEADER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.site-header {
  position: sticky;
  top: 0;
  z-index: 1000;
  background: rgba(250,248,255,0.88);
  backdrop-filter: blur(16px) saturate(180%);
  -webkit-backdrop-filter: blur(16px) saturate(180%);
  border-bottom: 1.5px solid rgba(124,58,237,.10);
  padding: 0 clamp(16px, 4vw, 48px);
}
.header-inner {
  max-width: 1200px;
  margin: 0 auto;
  height: 64px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
}
.site-logo {
  display: flex;
  align-items: center;
  gap: 10px;
  text-decoration: none;
  flex-shrink: 0;
}
.logo-mark {
  width: 36px; height: 36px;
  background: linear-gradient(135deg, var(--accent) 0%, #c026d3 100%);
  border-radius: 10px;
  display: grid;
  place-items: center;
  font-family: var(--font-dot);
  color: white;
  font-size: 14px;
  flex-shrink: 0;
}
.logo-text { font-family: var(--font-display); font-size: 1.25rem; font-weight: 700; color: var(--ink); }
.logo-sub { font-family: var(--font-dot); font-size: 0.6rem; color: var(--ink-soft); display: block; }

.header-right { display: flex; align-items: center; gap: 8px; }

.btn-back {
  display: flex; align-items: center; gap: 6px;
  padding: 8px 16px;
  border-radius: var(--r-full);
  font-size: 0.82rem; font-weight: 700;
  color: var(--ink-mid);
  text-decoration: none;
  border: 1.5px solid rgba(90,60,120,.15);
  transition: background .2s, transform .2s;
}
.btn-back:hover { background: var(--accent-light); color: var(--accent); transform: translateX(-2px); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH SECTIONï¼ˆãƒ­ã‚°ã‚¤ãƒ³å‰ï¼‰
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.auth-section {
  position: relative;
  z-index: 1;
  min-height: calc(100vh - 64px);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 40px 20px;
}

.auth-card {
  background: white;
  border-radius: var(--r-xl);
  padding: clamp(32px, 5vw, 56px) clamp(24px, 4vw, 48px);
  max-width: 440px;
  width: 100%;
  box-shadow: var(--shadow-lg);
  border: 1.5px solid rgba(124,58,237,.08);
  text-align: center;
  position: relative;
  overflow: hidden;
}

.auth-card::before {
  content: '';
  position: absolute;
  top: -60px; left: 50%;
  transform: translateX(-50%);
  width: 300px; height: 300px;
  background: radial-gradient(circle, rgba(124,58,237,.08) 0%, transparent 70%);
  pointer-events: none;
}

.auth-icon {
  width: 72px; height: 72px;
  border-radius: 20px;
  background: linear-gradient(135deg, var(--accent) 0%, #c026d3 100%);
  display: grid;
  place-items: center;
  font-size: 2rem;
  margin: 0 auto 20px;
  box-shadow: 0 4px 16px rgba(124,58,237,.3);
}

.auth-title {
  font-family: var(--font-display);
  font-size: 1.6rem;
  font-weight: 700;
  margin-bottom: 8px;
}

.auth-desc {
  font-size: 0.85rem;
  color: var(--ink-mid);
  line-height: 1.8;
  margin-bottom: 32px;
}

/* ã‚¿ãƒ– */
.auth-tabs {
  display: flex;
  background: var(--bg);
  border-radius: var(--r-full);
  padding: 3px;
  margin-bottom: 28px;
}
.auth-tab {
  flex: 1;
  padding: 9px;
  border-radius: var(--r-full);
  font-size: 0.85rem; font-weight: 700;
  cursor: pointer;
  border: none;
  background: transparent;
  color: var(--ink-soft);
  transition: background .2s, color .2s;
}
.auth-tab.active {
  background: white;
  color: var(--accent);
  box-shadow: var(--shadow-sm);
}

/* ãƒ•ã‚©ãƒ¼ãƒ  */
.auth-form { display: flex; flex-direction: column; gap: 14px; }
.form-group { text-align: left; }
.form-label {
  display: block;
  font-size: 0.78rem; font-weight: 700;
  color: var(--ink-mid);
  margin-bottom: 6px;
  letter-spacing: 0.04em;
}
.form-input {
  width: 100%;
  padding: 12px 16px;
  border: 1.5px solid rgba(124,58,237,.15);
  border-radius: var(--r-md);
  font-family: var(--font-body);
  font-size: 0.92rem;
  color: var(--ink);
  background: var(--bg);
  transition: border-color .2s, box-shadow .2s;
  outline: none;
}
.form-input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(124,58,237,.1);
}

.btn-auth {
  width: 100%;
  padding: 14px;
  background: linear-gradient(135deg, var(--accent) 0%, #c026d3 100%);
  color: white;
  border: none;
  border-radius: var(--r-full);
  font-family: var(--font-body);
  font-size: 0.95rem; font-weight: 700;
  cursor: pointer;
  letter-spacing: 0.04em;
  box-shadow: 0 4px 16px rgba(124,58,237,.3);
  transition: transform .2s, box-shadow .2s;
  margin-top: 4px;
}
.btn-auth:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(124,58,237,.4); }
.btn-auth:disabled { opacity: 0.6; transform: none; cursor: not-allowed; }

.divider {
  display: flex; align-items: center; gap: 12px;
  margin: 4px 0;
  font-size: 0.76rem; color: var(--ink-soft);
}
.divider::before, .divider::after {
  content: '';
  flex: 1;
  height: 1px;
  background: rgba(124,58,237,.12);
}

.btn-google {
  width: 100%;
  padding: 13px;
  background: white;
  color: var(--ink);
  border: 1.5px solid rgba(0,0,0,.12);
  border-radius: var(--r-full);
  font-family: var(--font-body);
  font-size: 0.92rem; font-weight: 700;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center; gap: 10px;
  box-shadow: var(--shadow-sm);
  transition: transform .2s, box-shadow .2s;
}
.btn-google:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }

.auth-error {
  background: #fff0f0;
  border: 1px solid #ffbcbc;
  color: #c0392b;
  border-radius: var(--r-md);
  padding: 10px 14px;
  font-size: 0.82rem;
  text-align: left;
  display: none;
}
.auth-error.show { display: block; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MYPAGEï¼ˆãƒ­ã‚°ã‚¤ãƒ³å¾Œï¼‰
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.mypage-section {
  position: relative; z-index: 1;
  padding: clamp(32px, 5vw, 60px) clamp(16px, 4vw, 48px);
  display: none; /* ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«è¡¨ç¤º */
}

.mypage-inner { max-width: 1000px; margin: 0 auto; }

/* â”€â”€ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ â”€â”€ */
.profile-header {
  background: white;
  border-radius: var(--r-xl);
  padding: clamp(24px, 4vw, 40px);
  box-shadow: var(--shadow-card);
  border: 1.5px solid rgba(124,58,237,.06);
  margin-bottom: 24px;
  display: flex;
  align-items: center;
  gap: 24px;
  flex-wrap: wrap;
  position: relative;
  overflow: hidden;
}

.profile-header::before {
  content: '';
  position: absolute;
  top: -60px; right: -60px;
  width: 280px; height: 280px;
  background: radial-gradient(circle, rgba(124,58,237,.06) 0%, transparent 70%);
  pointer-events: none;
}

.avatar-wrap { position: relative; flex-shrink: 0; }

.avatar {
  width: 80px; height: 80px;
  border-radius: 22px;
  background: linear-gradient(135deg, var(--accent) 0%, #c026d3 100%);
  display: grid;
  place-items: center;
  font-size: 2.2rem;
  box-shadow: 0 4px 16px rgba(124,58,237,.25);
  cursor: pointer;
  transition: transform .2s;
  position: relative;
  overflow: hidden;
}
.avatar:hover { transform: scale(1.05); }
.avatar img {
  width: 100%; height: 100%;
  object-fit: cover;
  border-radius: 22px;
}

.avatar-edit-btn {
  position: absolute;
  bottom: -4px; right: -4px;
  width: 26px; height: 26px;
  border-radius: 50%;
  background: white;
  border: 2px solid var(--bg);
  box-shadow: var(--shadow-sm);
  display: grid;
  place-items: center;
  font-size: 0.7rem;
  cursor: pointer;
  z-index: 1;
}

.profile-info { flex: 1; min-width: 0; }

/* ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åå‰ç·¨é›† */
.username-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 6px;
  flex-wrap: wrap;
}
.username-display {
  font-family: var(--font-display);
  font-size: clamp(1.3rem, 3vw, 1.8rem);
  font-weight: 700;
  color: var(--ink);
}
.btn-edit-name {
  padding: 4px 12px;
  border-radius: var(--r-full);
  font-size: 0.72rem; font-weight: 700;
  color: var(--accent);
  border: 1.5px solid rgba(124,58,237,.25);
  background: var(--accent-light);
  cursor: pointer;
  transition: background .2s;
}
.btn-edit-name:hover { background: rgba(124,58,237,.15); }

.username-edit-form {
  display: none;
  align-items: center;
  gap: 8px;
  margin-bottom: 6px;
}
.username-edit-form.show { display: flex; }
.username-input {
  padding: 8px 14px;
  border: 1.5px solid var(--accent);
  border-radius: var(--r-md);
  font-family: var(--font-display);
  font-size: 1.2rem; font-weight: 700;
  color: var(--ink);
  outline: none;
  max-width: 220px;
}
.btn-save-name {
  padding: 7px 16px;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: var(--r-full);
  font-size: 0.82rem; font-weight: 700;
  cursor: pointer;
}
.btn-cancel-name {
  padding: 7px 12px;
  background: transparent;
  color: var(--ink-soft);
  border: 1.5px solid rgba(0,0,0,.1);
  border-radius: var(--r-full);
  font-size: 0.82rem;
  cursor: pointer;
}

.profile-email { font-size: 0.82rem; color: var(--ink-soft); margin-bottom: 14px; }

.profile-badges { display: flex; gap: 8px; flex-wrap: wrap; }
.profile-badge {
  display: inline-flex; align-items: center; gap: 5px;
  padding: 4px 12px;
  border-radius: var(--r-full);
  font-size: 0.72rem; font-weight: 700;
  background: var(--accent-light);
  color: var(--accent);
  letter-spacing: 0.04em;
}

.profile-actions { margin-left: auto; display: flex; flex-direction: column; gap: 8px; align-items: flex-end; }
.btn-logout {
  padding: 8px 18px;
  border-radius: var(--r-full);
  font-size: 0.8rem; font-weight: 700;
  color: var(--ink-soft);
  border: 1.5px solid rgba(0,0,0,.1);
  background: transparent;
  cursor: pointer;
  transition: background .2s, color .2s;
}
.btn-logout:hover { background: #fff0f0; color: #c0392b; border-color: #ffbcbc; }

/* â”€â”€ çµ±è¨ˆãƒãƒ¼ â”€â”€ */
.stats-bar {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 12px;
  margin-bottom: 32px;
}
.stat-card {
  background: white;
  border-radius: var(--r-lg);
  padding: 20px;
  box-shadow: var(--shadow-sm);
  border: 1.5px solid rgba(124,58,237,.06);
  text-align: center;
}
.stat-card .num {
  font-family: var(--font-display);
  font-size: 2rem; font-weight: 700;
  color: var(--accent);
  display: block; line-height: 1;
}
.stat-card .label {
  font-family: var(--font-dot);
  font-size: 0.7rem; color: var(--ink-soft);
  letter-spacing: 0.08em;
  margin-top: 6px; display: block;
}

/* â”€â”€ è¨ºæ–­å±¥æ­´ã‚»ã‚¯ã‚·ãƒ§ãƒ³ â”€â”€ */
.history-section-title {
  font-family: var(--font-display);
  font-size: 1.2rem; font-weight: 700;
  margin-bottom: 16px;
  display: flex; align-items: center; gap: 10px;
}
.history-filter {
  display: flex; gap: 6px; flex-wrap: wrap;
  margin-bottom: 20px;
}
.filter-chip {
  padding: 6px 14px;
  border-radius: var(--r-full);
  font-size: 0.78rem; font-weight: 700;
  cursor: pointer;
  border: 1.5px solid transparent;
  background: white;
  color: var(--ink-mid);
  box-shadow: var(--shadow-sm);
  transition: all .18s;
}
.filter-chip:hover { transform: translateY(-1px); }
.filter-chip.active { background: var(--ink); color: white; }
.filter-chip[data-genre="love"].active { background: var(--love-light); color: var(--love-dark); border-color: var(--love); }
.filter-chip[data-genre="friend"].active { background: var(--friend-light); color: var(--friend-dark); border-color: var(--friend); }
.filter-chip[data-genre="work"].active { background: var(--work-light); color: var(--work-dark); border-color: var(--work); }
.filter-chip[data-genre="other"].active { background: var(--other-light); color: var(--other-dark); border-color: var(--other); }

/* â”€â”€ å±¥æ­´ã‚«ãƒ¼ãƒ‰ãƒªã‚¹ãƒˆ â”€â”€ */
.history-list { display: flex; flex-direction: column; gap: 14px; }

.history-card {
  background: white;
  border-radius: var(--r-lg);
  border: 1.5px solid rgba(124,58,237,.06);
  box-shadow: var(--shadow-sm);
  overflow: hidden;
  transition: box-shadow .2s, transform .2s;
}
.history-card:hover { box-shadow: var(--shadow-md); transform: translateY(-2px); }

.history-card-header {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 18px 20px;
  cursor: pointer;
  user-select: none;
}
.history-card-icon {
  width: 48px; height: 48px;
  border-radius: var(--r-sm);
  display: grid; place-items: center;
  font-size: 1.6rem;
  flex-shrink: 0;
}
.history-card-meta { flex: 1; min-width: 0; }
.history-card-title {
  font-family: var(--font-display);
  font-size: 0.98rem; font-weight: 700;
  margin-bottom: 4px; color: var(--ink);
}
.history-card-date {
  font-family: var(--font-dot);
  font-size: 0.68rem; color: var(--ink-soft);
  letter-spacing: 0.06em;
}
.history-card-badge {
  display: inline-flex; align-items: center; gap: 4px;
  padding: 3px 10px;
  border-radius: var(--r-full);
  font-size: 0.68rem; font-weight: 700;
  flex-shrink: 0;
}
.history-card-arrow {
  width: 30px; height: 30px;
  border-radius: 50%;
  display: grid; place-items: center;
  font-size: 0.9rem;
  background: var(--bg);
  color: var(--ink-soft);
  transition: transform .2s, background .2s;
  flex-shrink: 0;
}
.history-card.open .history-card-arrow { transform: rotate(90deg); background: var(--accent-light); color: var(--accent); }

/* â”€â”€ çµæœãƒ‘ãƒãƒ«ï¼ˆå±•é–‹ï¼‰ â”€â”€ */
.history-card-body {
  max-height: 0;
  overflow: hidden;
  transition: max-height .4s ease;
}
.history-card.open .history-card-body { max-height: 1000px; }

.result-panel {
  padding: 0 20px 20px;
  border-top: 1px solid rgba(124,58,237,.06);
}
.result-type-label {
  font-family: var(--font-dot);
  font-size: 0.7rem; letter-spacing: 0.12em;
  color: var(--ink-soft);
  margin: 16px 0 8px;
  text-transform: uppercase;
}
.result-type-value {
  font-family: var(--font-display);
  font-size: 1.3rem; font-weight: 700;
  color: var(--ink);
  margin-bottom: 10px;
}
.result-desc {
  font-size: 0.84rem;
  color: var(--ink-mid);
  line-height: 1.8;
  background: var(--bg);
  border-radius: var(--r-md);
  padding: 14px 16px;
  margin-bottom: 16px;
}
.result-scores { display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; }
.score-row { display: flex; align-items: center; gap: 10px; }
.score-name { font-size: 0.8rem; font-weight: 700; min-width: 90px; color: var(--ink-mid); }
.score-bar-wrap {
  flex: 1;
  height: 8px;
  background: var(--bg);
  border-radius: var(--r-full);
  overflow: hidden;
}
.score-bar-fill {
  height: 100%;
  border-radius: var(--r-full);
  background: linear-gradient(90deg, var(--accent), #c026d3);
  transition: width .6s ease;
}
.score-num { font-family: var(--font-dot); font-size: 0.72rem; color: var(--ink-soft); min-width: 30px; text-align: right; }

.result-actions { display: flex; gap: 8px; }
.btn-retry {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 9px 18px;
  background: var(--accent);
  color: white;
  border: none;
  border-radius: var(--r-full);
  font-family: var(--font-body);
  font-size: 0.82rem; font-weight: 700;
  cursor: pointer;
  text-decoration: none;
  transition: transform .2s;
}
.btn-retry:hover { transform: translateY(-2px); }
.btn-delete {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 9px 16px;
  background: transparent;
  color: var(--ink-soft);
  border: 1.5px solid rgba(0,0,0,.1);
  border-radius: var(--r-full);
  font-size: 0.82rem; font-weight: 700;
  cursor: pointer;
  transition: all .2s;
}
.btn-delete:hover { background: #fff0f0; color: #c0392b; border-color: #ffbcbc; }

/* â”€â”€ ç©ºã®å±¥æ­´ â”€â”€ */
.history-empty {
  text-align: center;
  padding: 60px 20px;
  background: white;
  border-radius: var(--r-xl);
  border: 2px dashed rgba(124,58,237,.15);
}
.history-empty .empty-icon { font-size: 3rem; margin-bottom: 16px; }
.history-empty h3 { font-family: var(--font-display); font-size: 1.1rem; color: var(--ink-mid); margin-bottom: 8px; }
.history-empty p { font-size: 0.84rem; color: var(--ink-soft); line-height: 1.8; }
.history-empty .btn-go {
  display: inline-flex; align-items: center; gap: 6px;
  margin-top: 20px;
  padding: 11px 24px;
  background: linear-gradient(135deg, var(--accent), #c026d3);
  color: white;
  border-radius: var(--r-full);
  text-decoration: none;
  font-weight: 700; font-size: 0.88rem;
  box-shadow: 0 4px 14px rgba(124,58,237,.3);
}

/* â”€â”€ ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° â”€â”€ */
.loading-overlay {
  position: fixed; inset: 0;
  background: rgba(250,248,255,.9);
  display: grid; place-items: center;
  z-index: 2000;
  transition: opacity .3s;
}
.loading-overlay.hide { opacity: 0; pointer-events: none; }
.loading-spinner {
  width: 48px; height: 48px;
  border: 3px solid rgba(124,58,237,.2);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* â”€â”€ ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ â”€â”€ */
.toast {
  position: fixed;
  bottom: 24px; left: 50%;
  transform: translateX(-50%) translateY(80px);
  background: var(--ink);
  color: white;
  padding: 12px 24px;
  border-radius: var(--r-full);
  font-size: 0.88rem; font-weight: 700;
  box-shadow: var(--shadow-lg);
  z-index: 3000;
  transition: transform .3s ease;
  white-space: nowrap;
}
.toast.show { transform: translateX(-50%) translateY(0); }

/* â”€â”€ ã‚¢ãƒã‚¿ãƒ¼é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« â”€â”€ */
.modal-overlay {
  position: fixed; inset: 0;
  background: rgba(26,20,36,.5);
  backdrop-filter: blur(4px);
  z-index: 2000;
  display: none; place-items: center;
}
.modal-overlay.open { display: grid; }
.modal-box {
  background: white;
  border-radius: var(--r-xl);
  padding: 32px 28px;
  max-width: 400px; width: calc(100% - 40px);
  box-shadow: var(--shadow-lg);
}
.modal-title {
  font-family: var(--font-display);
  font-size: 1.1rem; font-weight: 700;
  margin-bottom: 20px; text-align: center;
}
.emoji-grid {
  display: grid;
  grid-template-columns: repeat(6, 1fr);
  gap: 8px;
  margin-bottom: 20px;
}
.emoji-option {
  width: 48px; height: 48px;
  border-radius: var(--r-sm);
  background: var(--bg);
  display: grid; place-items: center;
  font-size: 1.5rem;
  cursor: pointer;
  border: 2px solid transparent;
  transition: all .15s;
}
.emoji-option:hover { background: var(--accent-light); transform: scale(1.1); }
.emoji-option.selected { border-color: var(--accent); background: var(--accent-light); }
.modal-close {
  width: 100%;
  padding: 11px;
  border-radius: var(--r-full);
  font-size: 0.88rem; font-weight: 700;
  color: var(--ink-mid);
  background: var(--bg);
  border: 1.5px solid rgba(0,0,0,.1);
  cursor: pointer;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 640px) {
  .profile-header { flex-direction: column; align-items: flex-start; }
  .profile-actions { margin-left: 0; flex-direction: row; align-items: center; }
  .stats-bar { grid-template-columns: 1fr 1fr; }
}
</style>
</head>

<body>

<!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
<div class="loading-overlay" id="loadingOverlay">
  <div class="loading-spinner"></div>
</div>

<!-- ãƒˆãƒ¼ã‚¹ãƒˆ -->
<div class="toast" id="toast"></div>

<!-- ã‚¢ãƒã‚¿ãƒ¼é¸æŠãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal-overlay" id="avatarModal">
  <div class="modal-box">
    <h3 class="modal-title">ğŸ¨ ã‚¢ãƒã‚¿ãƒ¼ã‚’é¸ã¶</h3>
    <div class="emoji-grid" id="emojiGrid">
      <!-- JSã§ç”Ÿæˆ -->
    </div>
    <button class="modal-close" id="modalClose">é–‰ã˜ã‚‹</button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â• HEADER â•â•â•â•â•â•â•â• -->
<header class="site-header">
  <div class="header-inner">
    <a href="./index.html" class="site-logo">
      <div class="logo-mark">âš—</div>
      <span>
        <span class="logo-text">SHINDAN LAB</span>
        <span class="logo-sub">è¨ºæ–­ã®å®Ÿé¨“å®¤</span>
      </span>
    </a>
    <div class="header-right">
      <a href="./index.html" class="btn-back">â† ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</a>
    </div>
  </div>
</header>

<!-- â•â•â•â•â•â•â•â• AUTHï¼ˆãƒ­ã‚°ã‚¤ãƒ³å‰ï¼‰ â•â•â•â•â•â•â•â• -->
<div class="auth-section" id="authSection">
  <div class="auth-card">
    <div class="auth-icon">ğŸ§ª</div>
    <h1 class="auth-title">ãƒã‚¤ãƒšãƒ¼ã‚¸</h1>
    <p class="auth-desc">ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã€è¨ºæ–­ã®è¨˜éŒ²ã‚’ä¿å­˜ãƒ»ç®¡ç†ã—ã‚ˆã†ã€‚</p>

    <!-- ã‚¿ãƒ– -->
    <div class="auth-tabs">
      <button class="auth-tab active" id="tabLogin" onclick="switchTab('login')">ãƒ­ã‚°ã‚¤ãƒ³</button>
      <button class="auth-tab" id="tabRegister" onclick="switchTab('register')">æ–°è¦ç™»éŒ²</button>
    </div>

    <!-- ã‚¨ãƒ©ãƒ¼ -->
    <div class="auth-error" id="authError"></div>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  -->
    <form class="auth-form" id="loginForm" onsubmit="handleLogin(event)">
      <div class="form-group">
        <label class="form-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
        <input type="email" class="form-input" id="loginEmail" placeholder="your@email.com" required>
      </div>
      <div class="form-group">
        <label class="form-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
        <input type="password" class="form-input" id="loginPassword" placeholder="6æ–‡å­—ä»¥ä¸Š" required>
      </div>
      <button type="submit" class="btn-auth" id="loginBtn">ãƒ­ã‚°ã‚¤ãƒ³ â†’</button>
    </form>

    <!-- ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ  -->
    <form class="auth-form" id="registerForm" style="display:none" onsubmit="handleRegister(event)">
      <div class="form-group">
        <label class="form-label">ãƒ¦ãƒ¼ã‚¶ãƒ¼å</label>
        <input type="text" class="form-input" id="regUsername" placeholder="è¡¨ç¤ºåã‚’å…¥åŠ›" required maxlength="20">
      </div>
      <div class="form-group">
        <label class="form-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
        <input type="email" class="form-input" id="regEmail" placeholder="your@email.com" required>
      </div>
      <div class="form-group">
        <label class="form-label">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
        <input type="password" class="form-input" id="regPassword" placeholder="6æ–‡å­—ä»¥ä¸Š" required minlength="6">
      </div>
      <button type="submit" class="btn-auth" id="registerBtn">ç™»éŒ²ã—ã¦å§‹ã‚ã‚‹ â†’</button>
    </form>

    <div class="divider">ã¾ãŸã¯</div>

    <button class="btn-google" onclick="handleGoogleLogin()">
      <svg width="18" height="18" viewBox="0 0 18 18"><path d="M17.64 9.2c0-.637-.057-1.251-.164-1.84H9v3.481h4.844a4.14 4.14 0 0 1-1.796 2.716v2.259h2.908c1.702-1.567 2.684-3.875 2.684-6.615z" fill="#4285F4"/><path d="M9 18c2.43 0 4.467-.806 5.956-2.184l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z" fill="#34A853"/><path d="M3.964 10.706A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.706V4.962H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.038l3.007-2.332z" fill="#FBBC05"/><path d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.962L3.964 6.294C4.672 4.169 6.656 3.58 9 3.58z" fill="#EA4335"/></svg>
      Googleã§ãƒ­ã‚°ã‚¤ãƒ³
    </button>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â• MYPAGEï¼ˆãƒ­ã‚°ã‚¤ãƒ³å¾Œï¼‰ â•â•â•â•â•â•â•â• -->
<section class="mypage-section" id="mypageSection">
  <div class="mypage-inner">

    <!-- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <div class="profile-header">
      <div class="avatar-wrap">
        <div class="avatar" id="avatarDisplay" onclick="openAvatarModal()">ğŸ§ª</div>
        <div class="avatar-edit-btn" onclick="openAvatarModal()">âœï¸</div>
      </div>

      <div class="profile-info">
        <!-- åå‰è¡¨ç¤º -->
        <div class="username-row" id="usernameRow">
          <span class="username-display" id="usernameDisplay">ãƒ¦ãƒ¼ã‚¶ãƒ¼</span>
          <button class="btn-edit-name" onclick="startEditName()">âœï¸ ç·¨é›†</button>
        </div>
        <!-- åå‰ç·¨é›†ãƒ•ã‚©ãƒ¼ãƒ  -->
        <div class="username-edit-form" id="usernameEditForm">
          <input type="text" class="username-input" id="usernameInput" maxlength="20" placeholder="åå‰ã‚’å…¥åŠ›">
          <button class="btn-save-name" onclick="saveName()">ä¿å­˜</button>
          <button class="btn-cancel-name" onclick="cancelEditName()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>

        <p class="profile-email" id="profileEmail"></p>
        <div class="profile-badges">
          <span class="profile-badge" id="memberBadge">ğŸ§ª LABãƒ¡ãƒ³ãƒãƒ¼</span>
          <span class="profile-badge" id="diagCountBadge">ğŸ“Š 0å›è¨ºæ–­æ¸ˆã¿</span>
        </div>
      </div>

      <div class="profile-actions">
        <button class="btn-logout" onclick="handleLogout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
      </div>
    </div>

    <!-- çµ±è¨ˆãƒãƒ¼ -->
    <div class="stats-bar">
      <div class="stat-card">
        <span class="num" id="statTotal">0</span>
        <span class="label">TOTAL è¨ºæ–­å›æ•°</span>
      </div>
      <div class="stat-card">
        <span class="num" id="statGenres">0</span>
        <span class="label">å—è¨ºã‚¸ãƒ£ãƒ³ãƒ«æ•°</span>
      </div>
      <div class="stat-card">
        <span class="num" id="statRecent">â€”</span>
        <span class="label">æœ€çµ‚å—è¨ºæ—¥</span>
      </div>
      <div class="stat-card">
        <span class="num" id="statFavorite">â€”</span>
        <span class="label">ã‚ˆãè¨ºæ–­ã™ã‚‹ã‚¸ãƒ£ãƒ³ãƒ«</span>
      </div>
    </div>

    <!-- è¨ºæ–­å±¥æ­´ -->
    <h2 class="history-section-title">ğŸ”¬ è¨ºæ–­å±¥æ­´</h2>

    <div class="history-filter" id="historyFilter">
      <button class="filter-chip active" data-genre="all" onclick="filterHistory('all', this)">ğŸ”¬ ã™ã¹ã¦</button>
      <button class="filter-chip" data-genre="love" onclick="filterHistory('love', this)">ğŸ’• æ‹æ„›</button>
      <button class="filter-chip" data-genre="friend" onclick="filterHistory('friend', this)">ğŸ‘« å‹é”</button>
      <button class="filter-chip" data-genre="work" onclick="filterHistory('work', this)">ğŸ’¼ ä»•äº‹</button>
      <button class="filter-chip" data-genre="other" onclick="filterHistory('other', this)">ğŸŒˆ ãã®ä»–</button>
    </div>

    <div class="history-list" id="historyList">
      <!-- JS ã§æç”» -->
    </div>

  </div>
</section>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   JAVASCRIPT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ğŸ”¥ Firebase è¨­å®š
   â˜… ã“ã“ã«è‡ªåˆ†ã®Firebaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šã‚’è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const firebaseConfig = {
  apiKey:            "AIzaSyBLuQpm7NASl4kD4FTKPOmHNfuaWT_ydEI",
  authDomain:        "shindanlab-eedc0.firebaseapp.com",
  projectId:         "shindanlab-eedc0",
  storageBucket:     "shindanlab-eedc0.firebasestorage.app",
  messagingSenderId: "946383078896",
  appId:             "1:946383078896:web:09e48c3f75f2d7e8d8c935"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db   = firebase.firestore();

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   è¨ºæ–­ãƒ„ãƒ¼ãƒ«ãƒã‚¹ã‚¿ãƒ¼ãƒ‡ãƒ¼ã‚¿
   ï¼ˆdiagnosis-config.js ã¨åŒæœŸã—ã¦ãã ã•ã„ï¼‰
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const DIAGNOSIS_MASTER = {
  relationship: {
    title: 'ãµãŸã‚Šã®ãƒ¢ãƒ¤ãƒ¢ãƒ¤æ•´ç†å®¤',
    emoji: 'ğŸ’Œ',
    genre: 'love',
    genreLabel: 'ğŸ’• æ‹æ„›é–¢ä¿‚',
    path: './é–¢ä¿‚æ”¹å–„ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿/index.html',
    gradient: 'linear-gradient(135deg, #ffe4ef 0%, #fde8e8 100%)',
    iconBg: 'var(--love-light)',
    badgeBg: 'var(--love-light)', badgeColor: 'var(--love-dark)'
  },
  thinktype: {
    title: 'ThinkTypeï½œæ€è€ƒã‚¿ã‚¤ãƒ—è¨ºæ–­',
    emoji: 'ğŸ§ ',
    genre: 'work',
    genreLabel: 'ğŸ’¼ ä»•äº‹é–¢ä¿‚',
    path: './thinktype/index.html',
    gradient: 'linear-gradient(135deg, #dde9ff 0%, #ede9fe 100%)',
    iconBg: 'var(--work-light)',
    badgeBg: 'var(--work-light)', badgeColor: 'var(--work-dark)'
  },
  uniquetype: {
    title: 'ã‚ã‚‰ã„ã®ãƒ„ãƒœè¨ºæ–­',
    emoji: 'ğŸ˜‚',
    genre: 'other',
    genreLabel: 'ğŸŒˆ ãã®ä»–',
    path: './uniquetype/index.html',
    gradient: 'linear-gradient(135deg, #fef0d5 0%, #ffeef4 100%)',
    iconBg: 'var(--other-light)',
    badgeBg: 'var(--other-light)', badgeColor: 'var(--other-dark)'
  }
};

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let currentUser = null;
let allHistories = [];
let currentFilter = 'all';
let currentAvatar = 'ğŸ§ª';

const AVATAR_OPTIONS = ['ğŸ§ª','ğŸ”¬','ğŸŒ¸','ğŸŒˆ','ğŸ’','ğŸ¦‹','ğŸ¯','âš¡','ğŸŒ™','ğŸ­',
                        'ğŸ¦Š','ğŸ±','ğŸ¦„','ğŸŒº','ğŸª','ğŸ”®','ğŸ¨','ğŸ§©','âœ¨','ğŸš€'];

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function showToast(msg, duration = 2500) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), duration);
}

function showLoading(show) {
  document.getElementById('loadingOverlay').classList.toggle('hide', !show);
}

function showError(msg) {
  const el = document.getElementById('authError');
  el.textContent = msg;
  el.classList.add('show');
}
function clearError() {
  document.getElementById('authError').classList.remove('show');
}

function formatDate(ts) {
  if (!ts) return 'â€”';
  const d = ts.toDate ? ts.toDate() : new Date(ts);
  return d.toLocaleDateString('ja-JP', { year: 'numeric', month: 'long', day: 'numeric' });
}
function formatDateShort(ts) {
  if (!ts) return 'â€”';
  const d = ts.toDate ? ts.toDate() : new Date(ts);
  return d.toLocaleDateString('ja-JP', { month: 'numeric', day: 'numeric' });
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Auth ã‚¿ãƒ–åˆ‡æ›¿
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function switchTab(tab) {
  clearError();
  document.getElementById('loginForm').style.display = tab === 'login' ? 'flex' : 'none';
  document.getElementById('registerForm').style.display = tab === 'register' ? 'flex' : 'none';
  document.getElementById('tabLogin').classList.toggle('active', tab === 'login');
  document.getElementById('tabRegister').classList.toggle('active', tab === 'register');
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ãƒ­ã‚°ã‚¤ãƒ³
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function handleLogin(e) {
  e.preventDefault();
  clearError();
  const btn = document.getElementById('loginBtn');
  btn.disabled = true; btn.textContent = '...';
  try {
    const email = document.getElementById('loginEmail').value;
    const pass  = document.getElementById('loginPassword').value;
    await auth.signInWithEmailAndPassword(email, pass);
  } catch(err) {
    showError(getAuthErrorMsg(err.code));
    btn.disabled = false; btn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ â†’';
  }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   æ–°è¦ç™»éŒ²
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function handleRegister(e) {
  e.preventDefault();
  clearError();
  const btn = document.getElementById('registerBtn');
  btn.disabled = true; btn.textContent = '...';
  try {
    const username = document.getElementById('regUsername').value.trim();
    const email    = document.getElementById('regEmail').value;
    const pass     = document.getElementById('regPassword').value;
    const cred = await auth.createUserWithEmailAndPassword(email, pass);
    // Firestoreã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ä¿å­˜
    await db.collection('users').doc(cred.user.uid).set({
      username,
      email,
      avatar: 'ğŸ§ª',
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    await cred.user.updateProfile({ displayName: username });
  } catch(err) {
    showError(getAuthErrorMsg(err.code));
    btn.disabled = false; btn.textContent = 'ç™»éŒ²ã—ã¦å§‹ã‚ã‚‹ â†’';
  }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Googleãƒ­ã‚°ã‚¤ãƒ³
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function handleGoogleLogin() {
  clearError();
  try {
    const provider = new firebase.auth.GoogleAuthProvider();
    const cred = await auth.signInWithPopup(provider);
    // åˆå›ãªã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆ
    const userDoc = await db.collection('users').doc(cred.user.uid).get();
    if (!userDoc.exists) {
      await db.collection('users').doc(cred.user.uid).set({
        username: cred.user.displayName || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼',
        email: cred.user.email,
        avatar: 'ğŸ§ª',
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
    }
  } catch(err) {
    showError(getAuthErrorMsg(err.code));
  }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function handleLogout() {
  await auth.signOut();
  showToast('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸ');
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   èªè¨¼ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function getAuthErrorMsg(code) {
  const map = {
    'auth/user-not-found':      'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“',
    'auth/wrong-password':      'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“',
    'auth/invalid-email':       'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“',
    'auth/email-already-in-use':'ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã™ã§ã«ä½¿ç”¨ã•ã‚Œã¦ã„ã¾ã™',
    'auth/weak-password':       'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯6æ–‡å­—ä»¥ä¸Šã«ã—ã¦ãã ã•ã„',
    'auth/too-many-requests':   'ã—ã°ã‚‰ãæ™‚é–“ã‚’ãŠã„ã¦å†è©¦è¡Œã—ã¦ãã ã•ã„',
    'auth/popup-closed-by-user':'ãƒ­ã‚°ã‚¤ãƒ³ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ',
    'auth/invalid-credential':  'ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“',
  };
  return map[code] || `ãƒ­ã‚°ã‚¤ãƒ³ã‚¨ãƒ©ãƒ¼ï¼ˆ${code}ï¼‰`;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Auth çŠ¶æ…‹ç›£è¦–
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
auth.onAuthStateChanged(async (user) => {
  showLoading(true);
  if (user) {
    currentUser = user;
    document.getElementById('authSection').style.display  = 'none';
    document.getElementById('mypageSection').style.display = 'block';
    await loadUserProfile(user);
    await loadHistory(user);
  } else {
    currentUser = null;
    document.getElementById('authSection').style.display  = 'flex';
    document.getElementById('mypageSection').style.display = 'none';
  }
  showLoading(false);
});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’èª­ã¿è¾¼ã‚€
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadUserProfile(user) {
  try {
    const docRef = db.collection('users').doc(user.uid);
    const doc = await docRef.get();
    const data = doc.exists ? doc.data() : {};
    const username = data.username || user.displayName || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼';
    const avatar   = data.avatar || 'ğŸ§ª';
    currentAvatar  = avatar;

    // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå­˜åœ¨ã—ãªã„å ´åˆï¼ˆGoogleãƒ­ã‚°ã‚¤ãƒ³åˆå›ç­‰ï¼‰ã¯ä½œæˆ
    if (!doc.exists) {
      await docRef.set({
        username,
        email: user.email || '',
        avatar,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      console.log('[MyPage] usersãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ–°è¦ä½œæˆã—ã¾ã—ãŸ');
    }

    document.getElementById('usernameDisplay').textContent = username;
    document.getElementById('profileEmail').textContent    = user.email || '';
    document.getElementById('avatarDisplay').textContent   = avatar;
    console.log('[MyPage] ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«èª­ã¿è¾¼ã¿å®Œäº†:', username, avatar);
  } catch(e) {
    console.error('[MyPage] ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e.code, e.message);
    // ã‚¨ãƒ©ãƒ¼æ™‚ã¯Authæƒ…å ±ã ã‘ã§è¡¨ç¤º
    document.getElementById('usernameDisplay').textContent = user.displayName || 'ãƒ¦ãƒ¼ã‚¶ãƒ¼';
    document.getElementById('profileEmail').textContent    = user.email || '';
  }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   åå‰ç·¨é›†
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function startEditName() {
  const current = document.getElementById('usernameDisplay').textContent;
  document.getElementById('usernameInput').value = current;
  document.getElementById('usernameRow').style.display = 'none';
  document.getElementById('usernameEditForm').classList.add('show');
  document.getElementById('usernameInput').focus();
}
function cancelEditName() {
  document.getElementById('usernameRow').style.display = 'flex';
  document.getElementById('usernameEditForm').classList.remove('show');
}
async function saveName() {
  const newName = document.getElementById('usernameInput').value.trim();
  if (!newName) { showToast('âš ï¸ åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
  const btn = document.querySelector('.btn-save-name');
  btn.disabled = true; btn.textContent = 'ä¿å­˜ä¸­...';
  try {
    if (!currentUser) throw new Error('ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“');
    // Firestoreã®usersãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°
    await db.collection('users').doc(currentUser.uid).set(
      { username: newName },
      { merge: true }   // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå­˜åœ¨ã—ãªãã¦ã‚‚ä½œæˆã™ã‚‹
    );
    // Firebase Authã®displayNameã‚‚æ›´æ–°
    await currentUser.updateProfile({ displayName: newName });
    document.getElementById('usernameDisplay').textContent = newName;
    cancelEditName();
    showToast('âœ… åå‰ã‚’æ›´æ–°ã—ã¾ã—ãŸ');
    console.log('[MyPage] ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’æ›´æ–°ã—ã¾ã—ãŸ:', newName);
  } catch(e) {
    console.error('[MyPage] åå‰æ›´æ–°ã‚¨ãƒ©ãƒ¼:', e.code, e.message);
    showToast('âš ï¸ æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + e.message);
  } finally {
    btn.disabled = false; btn.textContent = 'ä¿å­˜';
  }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ã‚¢ãƒã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ€ãƒ«
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function openAvatarModal() {
  const grid = document.getElementById('emojiGrid');
  grid.innerHTML = AVATAR_OPTIONS.map(em => `
    <div class="emoji-option ${em === currentAvatar ? 'selected' : ''}" onclick="selectAvatar('${em}')">${em}</div>
  `).join('');
  document.getElementById('avatarModal').classList.add('open');
}
function closeAvatarModal() {
  document.getElementById('avatarModal').classList.remove('open');
}
async function selectAvatar(emoji) {
  currentAvatar = emoji;
  document.getElementById('avatarDisplay').textContent = emoji;
  // ã‚°ãƒªãƒƒãƒ‰æ›´æ–°
  document.querySelectorAll('.emoji-option').forEach(el => {
    el.classList.toggle('selected', el.textContent === emoji);
  });
  try {
    await db.collection('users').doc(currentUser.uid).set(
      { avatar: emoji },
      { merge: true }
    );
    showToast(`${emoji} ã‚¢ãƒã‚¿ãƒ¼ã‚’å¤‰æ›´ã—ã¾ã—ãŸ`);
  } catch(e) { /* ç¶šè¡Œ */ }
  setTimeout(closeAvatarModal, 400);
}
document.getElementById('modalClose').addEventListener('click', closeAvatarModal);
document.getElementById('avatarModal').addEventListener('click', (e) => {
  if (e.target === e.currentTarget) closeAvatarModal();
});

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   è¨ºæ–­å±¥æ­´ã‚’èª­ã¿è¾¼ã‚€
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function loadHistory(user) {
  try {
    // firebase-common.js ãŒ diagnosisHistory ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã« uid ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ä»˜ãã§ä¿å­˜
    const snap = await db
      .collection('diagnosisHistory')
      .where('uid', '==', user.uid)
      .orderBy('timestamp', 'desc')
      .limit(50)
      .get();

    allHistories = snap.docs.map(d => ({ id: d.id, ...d.data() }));
    console.log('[MyPage] å±¥æ­´ä»¶æ•°:', allHistories.length);
    updateStats();
    renderHistory();
  } catch(e) {
    console.error('[MyPage] å±¥æ­´èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e.code, e.message);
    // FAILED_PRECONDITION = è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æœªä½œæˆã®å ´åˆã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
    if (e.code === 'failed-precondition') {
      console.warn('[MyPage] è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒæœªä½œæˆã§ã™ã€‚Firebaseã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚');
      console.warn('[MyPage] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãªã—ã§å–å¾—ã—ã¾ã™');
      try {
        // orderByãªã—ã§å–å¾—ã—ã¦JSå´ã§ã‚½ãƒ¼ãƒˆ
        const snap2 = await db
          .collection('diagnosisHistory')
          .where('uid', '==', user.uid)
          .limit(50)
          .get();
        allHistories = snap2.docs
          .map(d => ({ id: d.id, ...d.data() }))
          .sort((a, b) => {
            const ta = a.timestamp?.toMillis?.() ?? 0;
            const tb = b.timestamp?.toMillis?.() ?? 0;
            return tb - ta;
          });
        console.log('[MyPage] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å–å¾—ä»¶æ•°:', allHistories.length);
      } catch(e2) {
        console.error('[MyPage] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚‚å¤±æ•—:', e2.message);
        allHistories = [];
      }
    } else {
      allHistories = [];
    }
    updateStats();
    renderHistory();
  }
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   çµ±è¨ˆã‚’æ›´æ–°
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function updateStats() {
  const total = allHistories.length;
  const genres = [...new Set(allHistories.map(h => {
    const m = DIAGNOSIS_MASTER[h.diagnosisId];
    return m ? m.genre : null;
  }).filter(Boolean))].length;

  // firebase-common.js ã¯ 'timestamp' ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ä¿å­˜
  const recentTs = allHistories[0]?.timestamp;
  const recentStr = recentTs ? formatDateShort(recentTs) : 'â€”';

  // ã‚ˆãè¨ºæ–­ã™ã‚‹ã‚¸ãƒ£ãƒ³ãƒ«
  const genreCount = {};
  allHistories.forEach(h => {
    const m = DIAGNOSIS_MASTER[h.diagnosisId];
    if (m) genreCount[m.genre] = (genreCount[m.genre] || 0) + 1;
  });
  const favoriteEntry = Object.entries(genreCount).sort((a,b) => b[1]-a[1])[0];
  const genreEmoji = { love:'ğŸ’•', friend:'ğŸ‘«', work:'ğŸ’¼', other:'ğŸŒˆ' };
  const favoriteStr = favoriteEntry ? genreEmoji[favoriteEntry[0]] || 'â€”' : 'â€”';

  document.getElementById('statTotal').textContent    = total;
  document.getElementById('statGenres').textContent   = genres;
  document.getElementById('statRecent').textContent   = recentStr;
  document.getElementById('statFavorite').textContent = favoriteStr;
  document.getElementById('diagCountBadge').textContent = `ğŸ“Š ${total}å›è¨ºæ–­æ¸ˆã¿`;
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   å±¥æ­´ãƒ•ã‚£ãƒ«ã‚¿
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function filterHistory(genre, btn) {
  currentFilter = genre;
  document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
  btn.classList.add('active');
  renderHistory();
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   å±¥æ­´ã‚’æç”»
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderHistory() {
  const list = document.getElementById('historyList');

  const filtered = currentFilter === 'all'
    ? allHistories
    : allHistories.filter(h => {
        const m = DIAGNOSIS_MASTER[h.diagnosisId];
        return m && m.genre === currentFilter;
      });

  if (filtered.length === 0) {
    list.innerHTML = `
      <div class="history-empty">
        <div class="empty-icon">ğŸ”¬</div>
        <h3>ã¾ã è¨ºæ–­è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“</h3>
        <p>è¨ºæ–­ã‚’å—ã‘ã‚‹ã¨ã€ã“ã“ã«çµæœãŒè¨˜éŒ²ã•ã‚Œã¾ã™ã€‚<br>æ°—ã«ãªã‚‹è¨ºæ–­ã‚’ãœã²è©¦ã—ã¦ã¿ã¦ãã ã•ã„ï¼</p>
        <a href="./index.html" class="btn-go">ğŸ§ª è¨ºæ–­ã‚’æ¢ã™</a>
      </div>`;
    return;
  }

  list.innerHTML = filtered.map(h => renderHistoryCard(h)).join('');
}

function renderHistoryCard(h) {
  const m = DIAGNOSIS_MASTER[h.diagnosisId] || {
    title: h.diagnosisId,
    emoji: 'ğŸ“Š',
    genre: 'other',
    genreLabel: 'ãã®ä»–',
    path: '#',
    iconBg: 'var(--bg)',
    badgeBg: 'var(--other-light)', badgeColor: 'var(--other-dark)'
  };

  // firebase-common.js ã¯ 'timestamp' ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ä¿å­˜
  const dateStr = formatDate(h.timestamp);

  // ã‚¹ã‚³ã‚¢ãƒãƒ¼HTML
  let scoresHtml = '';
  if (h.scores && typeof h.scores === 'object') {
    scoresHtml = `<div class="result-scores">` +
      Object.entries(h.scores).map(([k, v]) => {
        const pct = Math.min(100, Math.round((v / (h.maxScore || 5)) * 100));
        return `<div class="score-row">
          <span class="score-name">${k}</span>
          <div class="score-bar-wrap"><div class="score-bar-fill" style="width:${pct}%"></div></div>
          <span class="score-num">${v}</span>
        </div>`;
      }).join('') + `</div>`;
  }

  return `
    <div class="history-card" id="card-${h.id}">
      <div class="history-card-header" onclick="toggleCard('${h.id}')">
        <div class="history-card-icon" style="background:${m.iconBg}">${m.emoji}</div>
        <div class="history-card-meta">
          <div class="history-card-title">${m.title}</div>
          <div class="history-card-date">ğŸ“… ${dateStr}</div>
        </div>
        <span class="history-card-badge" style="background:${m.badgeBg};color:${m.badgeColor}">${m.genreLabel}</span>
        <div class="history-card-arrow">â€º</div>
      </div>
      <div class="history-card-body">
        <div class="result-panel">
          ${h.resultType ? `
            <p class="result-type-label">è¨ºæ–­çµæœã‚¿ã‚¤ãƒ—</p>
            <div class="result-type-value">${h.resultEmoji || ''} ${h.resultType}</div>
          ` : ''}
          ${h.resultDesc ? `<p class="result-desc">${h.resultDesc}</p>` : ''}
          ${scoresHtml}
          <div class="result-actions">
            <a href="${m.path}" class="btn-retry">ğŸ”¬ ã‚‚ã†ä¸€åº¦è¨ºæ–­ã™ã‚‹</a>
            <button class="btn-delete" onclick="deleteHistory('${h.id}')">ğŸ—‘ å‰Šé™¤</button>
          </div>
        </div>
      </div>
    </div>`;
}

function toggleCard(id) {
  document.getElementById(`card-${id}`).classList.toggle('open');
}

/* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   å±¥æ­´ã‚’å‰Šé™¤
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function deleteHistory(historyId) {
  if (!confirm('ã“ã®è¨ºæ–­è¨˜éŒ²ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
  try {
    // ä¿å­˜å…ˆã¨åŒã˜ diagnosisHistory ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‹ã‚‰å‰Šé™¤
    await db.collection('diagnosisHistory').doc(historyId).delete();
    allHistories = allHistories.filter(h => h.id !== historyId);
    updateStats();
    renderHistory();
    showToast('ğŸ—‘ å‰Šé™¤ã—ã¾ã—ãŸ');
  } catch(e) {
    console.error('[MyPage] å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', e.message);
    showToast('âš ï¸ å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   âœ… è¨ºæ–­çµæœã®ä¿å­˜ã¯ firebase-common.js ã®
      window.saveDiagnosisResult() ãŒæ‹…å½“ã—ã¾ã™ã€‚
   å„è¨ºæ–­ãƒ„ãƒ¼ãƒ«ï¼ˆthinktype / uniquetype ç­‰ï¼‰ã¯
   firebase-common.js ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ã§è‡ªå‹•çš„ã«
   diagnosisHistory ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã¸ä¿å­˜ã•ã‚Œã¾ã™ã€‚
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

</script>
</body>
</html>
